<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CURSOS COM EXPIRAÇÃO E NAVEGAÇÃO</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            text-align: center;
        }
        .page-container {
            max-width: 800px;
            width: 100%;
            margin-bottom: 40px;
        }
        .video-block {
            background-color: #34495e;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }
        h1 {
            color: #f1c40f;
            border-bottom: 2px solid #f1c40f;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        /* Estilos dos botões de navegação */
        .button-container {
            margin-bottom: 25px;
            border-bottom: 1px solid #4a6784;
            padding-bottom: 15px;
        }
        .course-button {
            padding: 10px 20px;
            margin: 0 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .course-button.active {
            background-color: #f1c40f;
            color: #2c3e50;
        }
        .course-button:not(.active) {
            background-color: #5d7d9a;
            color: #ecf0f1;
        }
        /* Estilos de Timer/Expiração */
        #mensagemExpiracao {
            display: none; 
            color: #e74c3c;
            font-size: 1.5em;
            margin-top: 20px;
        }
        .alerta-restante {
            background-color: #f39c12; 
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .hidden {
            display: none;
        }
        /* Estilos do Formulário de Presença */
        .presence-container {
            max-width: 800px;
            width: 100%;
            background-color: #34495e;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            margin-bottom: 40px;
        }
        .presence-container input[type="text"],
        .presence-container input[type="email"] {
            width: calc(80% - 16px);
            padding: 8px;
            margin-bottom: 15px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        .presence-container label {
            display: block;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="page-container">
        
        <div class="presence-container" id="presenceArea">
            <h2>✅ Registro de Presença</h2>
            
            <form action="https://formsubmit.co/autoescolaguarda@gmail.com" method="POST" id="presenceForm">
                
                <p>Preencha para registrar sua frequência nesta aula.</p>

                <label for="nome">Nome Completo:</label>
                <input type="text" name="Nome Completo" id="nome" required>

                <label for="email">Email:</label>
                <input type="email" name="Email" id="email" required>
                
                <input type="hidden" name="_next" value="https://autoescola-gf.github.io/cursinho/?presenca=true">
                
                <input type="hidden" name="_captcha" value="false">

                <button type="submit" style="padding: 10px 20px; background-color: #f1c40f; color: #2c3e50; border: none; border-radius: 5px; cursor: pointer;">
                    Registrar Presença
                </button>
            </form>
        </div>

        <div class="button-container">
            <button class="course-button" data-course-id="course1" onclick="showCourse('course1')">Aula 1</button>
            <button class="course-button" data-course-id="course2" onclick="showCourse('course2')">Aula 2</button>
        </div>

        <div id="course1" class="video-block hidden" data-storage-key="acesso_curso1">
            <h1 id="title1">AULA 01: SINALIZAÇÃO</h1>
            
            <div id="areaTimer1">
                <p class="alerta-restante" id="tempoRestanteMensagem1">O vídeo será removido...</p>
                
                <iframe 
                    src="https://player.vimeo.com/video/1140876472?badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479" 
                    width="100%" 
                    height="450" 
                    frameborder="0" 
                    allow="autoplay; fullscreen; picture-in-picture" 
                    allowfullscreen>
                </iframe>
            </div>
            <div id="mensagemExpiracao1" class="hidden">
                <p><strong>Tempo esgotado!</strong> O acesso a esta aula expirou.</p>
            </div>
        </div>

        <div id="course2" class="video-block hidden" data-storage-key="acesso_curso2">
            <h1 id="title2">AULA 02: SINALIZAÇÃO</h1>
            
            <div id="areaTimer2">
                <p class="alerta-restante" id="tempoRestanteMensagem2">O vídeo será removido...</p>
                
                <iframe 
                    src="https://player.vimeo.com/video/1140903162?badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479" 
                    width="100%" 
                    height="450" 
                    frameborder="0" 
                    allow="autoplay; fullscreen; picture-in-picture" 
                    allowfullscreen>
                </iframe>
            </div>
            <div id="mensagemExpiracao2" class="hidden">
                <p><strong>Tempo esgotado!</strong> O acesso a esta aula expirou.</p>
            </div>
        </div>

    </div>

    <script>
        // === CONFIGURAÇÃO GLOBAL ===
        const TEMPO_LIMITE_SEGUNDOS = 300; // 5 minutos (Ajuste para o timer dos vídeos)
        const TEMPO_LIMITE_MS = TEMPO_LIMITE_SEGUNDOS * 1000;
        const LIMITE_PRESENCA_MS = 24 * 60 * 60 * 1000; // 24 horas em milissegundos
        const CHAVE_PRESENCA = 'lastPresenceTime'; // Chave para o localStorage
        
        let intervaloContador = null;

        // --- Lógica de Parâmetros ---
        const urlParams = new URLSearchParams(window.location.search);
        const isBypass = urlParams.get('bypass') === 'true';
        const isClear = urlParams.get('clear') === 'true';
        const isPresenceSuccess = urlParams.get('presenca') === 'true'; // Novo parâmetro
        
        const pad = (num) => String(num).padStart(2, '0');

       // --- FUNÇÃO DE CONTROLE DE PRESENÇA (MODIFICADA) ---
function checkPresence() {
    const courseContent = document.getElementById('courseContent');
    const instructionMessage = document.getElementById('instructionMessage');
    
    const lastTime = parseInt(localStorage.getItem(CHAVE_PRESENCA));
    const currentTime = Date.now();
    
    // Se o tempo não está salvo OU se 24 horas se passaram
    if (isNaN(lastTime) || (currentTime - lastTime) >= LIMITE_PRESENCA_MS) {
        // Presença inválida ou expirada
        courseContent.classList.add('content-hidden'); // Esconde o curso
        instructionMessage.style.display = 'block'; // Mostra a instrução e o botão
    } else {
        // Presença válida
        courseContent.classList.remove('content-hidden'); // Mostra o curso
        instructionMessage.style.display = 'none'; // Esconde a instrução
    }
}

// --- 3. INICIALIZAÇÃO E LIMPEZA (EXECUTA AO CARREGAR A PÁGINA) ---
document.addEventListener('DOMContentLoaded', function() {
    // ... (Sua lógica de Limpeza) ...
    if (isClear) {
        // ... (Lógica de limpeza) ...
        return; 
    }

    // 1. Verifica Acesso (Presença)
    checkPresence();

    // 2. Inicia o primeiro curso, APENAS se estiver visível
    if (!document.getElementById('courseContent').classList.contains('content-hidden')) {
        showCourse('course1'); 
    }
});
        
        // --- FUNÇÃO PRINCIPAL DE EXPIRAÇÃO (Não alterada) ---
        function initializeTimer(courseId, storageKey) {
            if (intervaloContador) {
                clearInterval(intervaloContador);
            }
            
            const areaDoVideo = document.getElementById('areaTimer' + courseId.slice(-1));
            const mensagemExp = document.getElementById('mensagemExpiracao' + courseId.slice(-1));
            const mensagemTempoRestante = document.getElementById('tempoRestanteMensagem' + courseId.slice(-1));
            
            // ... (Restante da lógica do timer permanece o mesmo) ...
            if (isBypass) {
                areaDoVideo.classList.remove('hidden');
                mensagemExp.classList.add('hidden');
                mensagemTempoRestante.innerHTML = "MODO TESTE ATIVADO (Bypass). O vídeo não expirará.";
                return; 
            }
            
            let inicioVisualizacao = parseInt(localStorage.getItem(storageKey));
            const tempoAtual = Date.now();

            if (isNaN(inicioVisualizacao)) {
                inicioVisualizacao = tempoAtual;
                localStorage.setItem(storageKey, inicioVisualizacao);
            }

            const tempoDecorrido = tempoAtual - inicioVisualizacao;

            if (tempoDecorrido >= TEMPO_LIMITE_MS) {
                areaDoVideo.classList.add('hidden');
                mensagemExp.classList.remove('hidden');
            } else {
                areaDoVideo.classList.remove('hidden');
                mensagemExp.classList.add('hidden');

                intervaloContador = setInterval(function() {
                    const agora = Date.now();
                    const decorrido = agora - inicioVisualizacao;
                    let restanteMS = TEMPO_LIMITE_MS - decorrido;
                    
                    if (restanteMS <= 0) {
                        areaDoVideo.classList.add('hidden');
                        mensagemExp.classList.remove('hidden');
                        clearInterval(intervaloContador);
                    } else {
                        let totalSeconds = Math.floor(restanteMS / 1000);

                        const hours = Math.floor(totalSeconds / 3600);
                        totalSeconds %= 3600;
                        const minutes = Math.floor(totalSeconds / 60);
                        const seconds = totalSeconds % 60;
                        
                        const timeFormat = `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;

                        mensagemTempoRestante.innerHTML = `Disponível por: ${timeFormat}`; 
                    }
                }, 1000);
            }
        }

        // --- FUNÇÃO DE NAVEGAÇÃO ENTRE AULAS (Não alterada) ---
        function showCourse(courseId) {
            const allCourses = document.querySelectorAll('.video-block');
            const allButtons = document.querySelectorAll('.course-button');
            const selectedCourse = document.getElementById(courseId);
            const storageKey = selectedCourse.getAttribute('data-storage-key');
            
            allCourses.forEach(course => course.classList.add('hidden'));
            if (intervaloContador) { clearInterval(intervaloContador); }

            selectedCourse.classList.remove('hidden');

            allButtons.forEach(button => {
                button.classList.remove('active');
                if (button.getAttribute('data-course-id') === courseId) {
                    button.classList.add('active');
                }
            });

            initializeTimer(courseId, storageKey);
        }

        // --- 3. INICIALIZAÇÃO E LIMPEZA (EXECUTA AO CARREGAR A PÁGINA) ---
        document.addEventListener('DOMContentLoaded', function() {
            // Lógica de Limpeza do Timer do Vídeo
            if (isClear) {
                localStorage.removeItem('acesso_curso1');
                localStorage.removeItem('acesso_curso2');
                localStorage.removeItem(CHAVE_PRESENCA); // Limpa também o registro de presença!
                
                console.log("LocalStorage de vídeos e presença limpo. Redirecionando...");
                window.location.href = window.location.origin + window.location.pathname; 
                return; 
            }

            // 1. Verifica e esconde/mostra o formulário de presença
            checkPresence();

            // 2. Inicia o primeiro curso por padrão
            showCourse('course1'); 
        });
    </script>
</body>
</html>

